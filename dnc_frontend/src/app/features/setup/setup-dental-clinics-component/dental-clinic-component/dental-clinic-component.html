<div class="clinic-page">
  <!-- TOP HALF -->
  <mat-card class="top-card">
    <mat-card-header class="top-header">
      <div class="title-block">
        <mat-card-title class="mat-headline-2">{{ pageTitle() }}</mat-card-title>

        @if (loadState() !== 'loading') {
          <mat-card-subtitle>
            {{ pageSubtitle() }}
          </mat-card-subtitle>
        }
      </div>

      <div class="header-actions">
        <button mat-button type="button" (click)="onBack()">Back</button>
        <button mat-flat-button type="button" (click)="onSave()">
          {{ isCreate() ? 'Create' : 'Save' }}
        </button>
      </div>
    </mat-card-header>

    @if (loadState() === 'loading') {
      <mat-progress-bar mode="indeterminate"></mat-progress-bar>
    }

    @if (loadState() !== 'loading') {
      <mat-card-content>
        <form class="top-grid" [formGroup]="form">

          <!-- LEFT SIDE -->
          <div class="left-col">
            <mat-form-field appearance="outline" class="field">
              <mat-label>Name</mat-label>
              <input matInput formControlName="name" />
            </mat-form-field>

            <mat-form-field appearance="outline" class="field">
              <mat-label>Address</mat-label>
              <textarea matInput rows="4" formControlName="address"></textarea>
            </mat-form-field>

            <mat-form-field appearance="outline" class="field">
              <mat-label>Region</mat-label>
              <mat-select formControlName="region_id">
                <mat-option [value]="null">—</mat-option>
                @for (r of regions(); track r.id) {
                  <mat-option [value]="r.id">{{ r.name }}</mat-option>
                }
              </mat-select>
            </mat-form-field>

            <mat-form-field appearance="outline" class="field">
              <mat-label>State</mat-label>
              <mat-select formControlName="state_id">
                <mat-option [value]="null">—</mat-option>
                @for (s of filteredStates(); track s.id) {
                  <mat-option [value]="s.id">{{ s.name }}</mat-option>
                }
              </mat-select>
            </mat-form-field>

            <mat-form-field appearance="outline" class="field">
              <mat-label>City</mat-label>
              <mat-select formControlName="city_id">
                <mat-option [value]="null">—</mat-option>
                @for (c of filteredCities(); track c.id) {
                  <mat-option [value]="c.id">{{ c.name }}</mat-option>
                }
              </mat-select>
            </mat-form-field>
          </div>

          <!-- RIGHT SIDE -->
          <div class="right-col">
            <div class="capabilities-block">
              <div class="section-title">Clinic Capabilities</div>

              <div class="capabilities-list">
                @for (cap of clinicCapabilities(); track cap.id) {
                  <mat-checkbox
                    class="capability-item"
                    [checked]="true">
                    {{ cap.name }}
                  </mat-checkbox>
                }

                @if (clinicCapabilities()?.length === 0) {
                  <div class="capabilities-empty">
                    No capabilities loaded.
                  </div>
                }
              </div>
            </div>

            <div class="right-bottom">
              <mat-form-field appearance="outline" class="field">
                <mat-label>Remarks</mat-label>
                <textarea matInput rows="4" formControlName="remarks"></textarea>
              </mat-form-field>

              <mat-form-field appearance="outline" class="field">
                <mat-label>Contact Numbers</mat-label>
                <input matInput formControlName="contact_numbers" />
              </mat-form-field>

              <mat-slide-toggle class="toggle" formControlName="active">
                Active
              </mat-slide-toggle>
            </div>
          </div>

        </form>

        @if (loadState() === 'error') {
          <div class="error">
            Failed to load or save this clinic.
          </div>
        }
      </mat-card-content>
    }
  </mat-card>

  <!-- BOTTOM HALF -->
  <mat-card class="bottom-card">
    <mat-card-header>
      <mat-card-title class="mat-headline-4">Dentists</mat-card-title>
      <mat-card-subtitle>Assigned dentists will appear here</mat-card-subtitle>
    </mat-card-header>

    <mat-card-content class="bottom-content">
      <div class="dentists-placeholder">
        Dentists table goes here.
      </div>
    </mat-card-content>
  </mat-card>
</div>
