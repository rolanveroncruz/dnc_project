<h2 mat-dialog-title class="dialog-title">
  <div class="title-wrap">
    <div class="title-text">
      <div class="title">
        {{ isEdit ? 'Edit Clinic Capability' : 'New Clinic Capability' }}
      </div>
      <div class="subtitle">
        {{ isEdit ? 'Update capability name.' : 'Create a new clinic capability.' }}
      </div>
    </div>

    @if (hasChanges()) {
      <span class="status-chip">Unsaved changes</span>
    }
  </div>
</h2>

<div mat-dialog-content class="dialog-content">
  <form id="capForm" [formGroup]="form" class="grid" (ngSubmit)="save()">
    <!-- LEFT: Editable -->
    <section class="panel">
      <div class="panel-header">
        <div class="panel-title">Capability details</div>
        <div class="panel-hint">Fields marked * are required.</div>
      </div>

      <mat-form-field appearance="outline" class="full">
        <mat-label>Name *</mat-label>
        <input
          matInput
          formControlName="name"
          autocomplete="off"
          placeholder="e.g. X-ray, Orthodontics, Implant surgery"
        />
        <mat-hint>Short, clear name shown across the system</mat-hint>
        @if (form.controls.name.touched && form.controls.name.hasError('required')) {
          <mat-error>Name is required.</mat-error>
        }
        @if (form.controls.name.touched && form.controls.name.hasError('maxlength')) {
          <mat-error>Max 120 characters.</mat-error>
        }
      </mat-form-field>

    </section>

    <!-- RIGHT: Readonly meta -->
    <aside class="panel panel--meta">
      <div class="panel-header">
        <div class="panel-title">Audit</div>
        <div class="panel-hint">Read-only information.</div>
      </div>

      <div class="meta-row">
        <div class="meta-label">ID</div>
        <div class="meta-value">
          @if (data.id) {
            <span class="mono">#{{ data.id }}</span>
          } @else {
            —
          }
        </div>
      </div>

      <div class="meta-row">
        <div class="meta-label">Last modified by</div>
        <div class="meta-value">{{ data.last_modified_by ?? '—' }}</div>
      </div>

      <div class="meta-row">
        <div class="meta-label">Last modified on</div>
        <div class="meta-value">{{ (data.last_modified_on | date:'medium') ?? '—' }}</div>
      </div>
    </aside>
  </form>
</div>

<div mat-dialog-actions class="dialog-actions" align="end">
  <button mat-button type="submit" form="capForm" (click)="close()">Cancel</button>

  <button
    mat-flat-button
    type="submit"
    form="capForm"
    [disabled]="saveDisabled()"
  >
    Save
  </button>
</div>
